$(function(){$('[data-toggle="tooltip"]').tooltip()});$.fn.extend({showTooltip:function(c,b,d){b=b||"top";this.attr("data-original-title",c);this.tooltip({title:c,placement:b,trigger:"manual"});this.tooltip("show");var a=this;setTimeout(function(){a.tooltip("hide");if(typeof d==="function"){d()}},2000)}});$("#locales a").on("click",function(){Cookies.set("lang",$(this).html());location.reload()});$(".jumbotron .dismissible").on("click",function(){$(this).tooltip("dispose");$(this).parent().parent().slideUp(function(){$(this).remove()});Cookies.set($(this).data("cookie"),1)});$("#getImage").on("click",function(){var a=$("#url").val();$(this).prop("disabled",true);$("#url").prop("disabled",true);$("#loading").slideDown();if(a.includes("deviantart.com")||a.includes("fav.me")||a.includes("sta.sh")){getDeviantart(a,addImage)}else{if(a.includes("derpibooru.org")){getDerpibooru(a,addImage)}else{addImage(null)}}});function getDeviantart(b,c){var a=null;$.getJSON("http://backend.deviantart.com/oembed?url="+b+"&format=jsonp&callback=?").done(function(d){if(!("url" in d)){d.url=d.thumbnail_url}a=d}).fail(function(d){console.log(d)}).always(function(){c(a)})}function getDerpibooru(b,d){var a=null;var c=false;$.getJSON("https://derpibooru.org/oembed.json?url="+b).done(function(e){e.url=e.thumbnail_url;a=e;if(e.author_url.includes("deviantart.com")){getDeviantart(e.author_url,addImage);c=true}}).fail(function(e){console.log(e)}).always(function(){if(!c){d(a)}})}function addImage(a){if(a==null||"error" in a){$("#failed").slideDown();setTimeout(function(){$("#failed").slideUp()},3000)}else{a.data=JSON.stringify(a);$.get("views/elements/image.html",function(b){var c=Mustache.render(b,a);$(c).appendTo($("#wrapper")).hide().slideDown()});$("#url").val("")}$("#getImage").prop("disabled",false);$("#url").prop("disabled",false);$("#loading").slideUp()}$("#wrapper").on("click",".remove",function(){$(this).parent().parent().parent().slideUp(function(){$(this).remove()})});$("#settings_import:file").on("change",function(){var b=this.files[0];var a=new FileReader();a.onload=function(c){var d="";try{d=JSON.parse(c.target.result)}catch(f){}if(d==""){$("#settings_import").parent().showTooltip($("#settings_import").data("error"),"bottom");return}if(d.hasOwnProperty("bbcode")){Cookies.set("bbcode",d.bbcode)}if(d.hasOwnProperty("lang")){Cookies.set("lang",d.lang)}if(d.hasOwnProperty("hide_jumbo")){Cookies.set("hide_jumbo",d.hide_jumbo)}if(d.hasOwnProperty("hide_cookie")){Cookies.set("hide_cookie",d.hide_jumbo)}$("#settings_import").parent().showTooltip($("#settings_import").data("success"),"bottom")};a.readAsText(b)});$("#settings_export").on("click",function(){var b={};b.bbcode=Cookies.get("bbcode");b.lang=Cookies.get("lang");b.hide_jumbo=Cookies.get("hide_jumbo");b.hide_cookie=Cookies.get("hide_cookie");var a=JSON.stringify(b);download(a,"creator-settings.json","text/plain")});var bbCodeSaved=false;var bbCodeSaveTimeout;var initBbCode=false;$("#settings_bbcode").on("blur",function(){if(!bbCodeSaved){clearTimeout(bbCodeSaveTimeout);saveBbCode()}});$("#settings_bbcode").on("keyup",function(){clearTimeout(bbCodeSaveTimeout);bbCodeSaved=false;bbCodeSaveTimeout=setTimeout(function(){bbCodeSaved=true;saveBbCode()},1500)});$("#settings_bbcode").on("keydown",function(){bbCodeSaved=false;clearTimeout(bbCodeSaveTimeout)});$("#restore").on("click",resetBbCode);function saveBbCode(a){if(!initBbCode){return}if(typeof a=="undefined"){a=$("#settings_bbcode").val()}Cookies.set("bbcode",a);$("#settings_bbcode_saved").fadeIn().delay(500).fadeOut()}function resetBbCode(){var a="[spoiler=[url=%pageurl]%title[/url] by %author]\n[img]%url[/img]\n[/spoiler]";$("#settings_bbcode").val(a);saveBbCode(a)}var showJumbotronTriggerd=false;$("#settings_showJumbotron").on("click",function(){if(showJumbotronTriggerd){return}showJumbotronTriggerd=true;Cookies.set("hide_jumbo",0);var a=$(this);a.showTooltip(a.data("success"),"bottom",function(){a.parent().parent().slideUp(function(){$(this).remove()})})});$(".btn").on("mouseup",function(){$(this).blur()});$(document).ready(function(){initBbCode=true;var a=Cookies.get("bbcode");if(typeof a=="undefined"){resetBbCode()}else{$("#settings_bbcode").val(Cookies.get("bbcode"))}});